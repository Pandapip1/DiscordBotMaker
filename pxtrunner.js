var pxt,__awaiter=this&&this.__awaiter||function(e,a,s,c){return new(s||(s=Promise))(function(n,t){function i(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}r((c=c.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(n,i){var o,r,a,e,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(a=2&t[0]?r.return:t[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,t[1])).done)return a;switch(r=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(i){!function(e){e.startDebuggerAsync=function(e){new t(e).start()};var t=function(){function t(e){this.container=e,this.pkgLoaded=!1,this.intervalRunning=!1}return t.prototype.start=function(){var e=this;this.initializeWebsocket(),this.intervalRunning||(this.intervalRunning=!0,this.intervalId=setInterval(function(){if(!e.ws)try{e.initializeWebsocket()}catch(e){console.warn("Connection to server failed, retrying in "+t.RETRY_MS+" ms")}},t.RETRY_MS)),this.session=new pxsim.SimDebugSession(this.container),this.session.start(this)},t.prototype.initializeWebsocket=function(){var n=this;i.BrowserUtils.isLocalHost()&&i.Cloud.localToken&&(i.debug("initializing debug pipe"),this.ws=new WebSocket("ws://localhost:3234/"+i.Cloud.localToken+"/simdebug"),this.ws.onopen=function(e){i.debug("debug: socket opened")},this.ws.onclose=function(e){i.debug("debug: socket closed"),n.closeListener&&n.closeListener(),n.session.stopSimulator(),n.ws=void 0},this.ws.onerror=function(e){i.debug("debug: socket closed due to error"),n.errorListener&&n.errorListener(e.type),n.session.stopSimulator(),n.ws=void 0},this.ws.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){i.debug("debug: could not parse message")}t&&("runner"===t.type?n.handleRunnerMessage(t):("request"===t.type&&"launch"===t.command&&n.sendRunnerMessage("configure",{projectDir:t.arguments.projectDir}),n.dataListener(t)))})},t.prototype.send=function(e){this.ws.send(e)},t.prototype.onData=function(e){this.dataListener=e},t.prototype.onError=function(e){this.errorListener=e},t.prototype.onClose=function(e){this.closeListener=e},t.prototype.close=function(){this.session&&this.session.stopSimulator(!0),this.intervalRunning&&(clearInterval(this.intervalId),this.intervalId=void 0),this.ws&&this.ws.close()},t.prototype.handleRunnerMessage=function(e){switch(e.subtype){case"ready":this.sendRunnerMessage("ready");break;case"runcode":this.runCode(e)}},t.prototype.runCode=function(e){var t=[];e.breakpoints.forEach(function(e){t.push([e.id,{verified:!0,line:e.line,column:e.column,endLine:e.endLine,endColumn:e.endColumn,source:{path:e.fileName}}])}),this.session.runCode(e.code,e.usedParts,e.usedArguments,new pxsim.BreakpointMap(t),i.appTarget.simulator.boardDefinition)},t.prototype.sendRunnerMessage=function(e,t){void 0===t&&(t={}),t.subtype=e,t.type="runner",this.send(JSON.stringify(t))},t.RETRY_MS=2500,t}();e.DebugRunner=t}(i.runner||(i.runner={}))}(pxt||(pxt={})),function(O){!function(e){var P="icon xicon js",S="icon xicon python",E="icon xicon blocks",T="main.py",A="main.blocks";function r(){return{blocksAspectRatio:window.innerHeight<window.innerWidth?1.62:1/1.62,snippetClass:"lang-blocks",signatureClass:"lang-sig",blocksClass:"lang-block",blocksXmlClass:"lang-blocksxml",diffBlocksXmlClass:"lang-diffblocksxml",diffClass:"lang-diff",diffStaticPythonClass:"lang-diffspy",diffBlocksClass:"lang-diffblocks",staticPythonClass:"lang-spy",simulatorClass:"lang-sim",linksClass:"lang-cards",namespacesClass:"lang-namespaces",apisClass:"lang-apis",codeCardClass:"lang-codecard",packageClass:"lang-package",jresClass:"lang-jres",projectClass:"lang-project",snippetReplaceParent:!0,simulator:!0,showEdit:!0,hex:!0,tutorial:!1,showJavaScript:!1,hexName:O.appTarget.id}}function s(e){"undefined"!=typeof hljs&&(e.hasClass("highlight")?hljs.highlightBlock(e[0]):e.find("code.highlight").each(function(e,t){hljs.highlightBlock(t)}),a(e))}function a(e){e.find("span.hljs-comment:contains(@highlight)").each(function(e,t){try{!function(e){var t=$(e),n=document.createElement("span");n.className="highlight-line";var i=e.nextSibling;if(!i||i.nodeType!=Node.TEXT_NODE)return;var o=i.textContent,r=o.indexOf("\n");if(r<0)return;i.textContent=o.substring(0,r+1),$(document.createTextNode(o.substring(r+1).replace(/^\s+/,""))).insertAfter($(i)),i=i.nextSibling;for(;i;){var a=i.nextSibling;if(i.nodeType==Node.TEXT_NODE){var s=(o=i.textContent).indexOf("\n");if(!(s<0)){n.appendChild(document.createTextNode(o.substring(0,s))),i.textContent=o.substring(s+1);break}n.appendChild(i),i=a}else n.appendChild(i),i=a}$(n).insertAfter(t),t.remove()}(t)}catch(e){O.reportException(e)}})}function R(e,t){e.append($('<div class="ui content blocks"/>').append(t))}function j(e,t,n){e.append($('<div class="ui content js"><div class="subheading"><i class="ui icon xicon js"></i>JavaScript</div></div>').append(t)),s(t)}function B(e,t,n){e.append($('<div class="ui content py"><div class="subheading"><i class="ui icon xicon python"></i>Python</div></div>').append(t)),s(t)}function N(e,t){var n=$('<a class="item" role="button" tabindex="0"><i role="presentation" aria-hidden="true"></i><span class="ui desktop only"></span></a>');return n.attr("aria-label",e),n.attr("title",e),n.find("i").attr("class",t),n.find("span").text(e),n.keypress(function(e){var t="number"==typeof e.which?e.which:e.keyCode;13!==t&&32!==t||(e.preventDefault(),e.currentTarget.click())}),n}function b(r,e,a,t,n,i,o){void 0===o&&(o={});var s=$('<div class="ui bottom attached tabular icon small compact menu hideprint"> <div class="right icon menu"></div></div>'),c=$('<div class="ui top attached segment codewidget"></div>'),l=s.find(".right.menu"),d=O.appTarget.appTheme||{};if(o.showEdit&&!d.hideDocsEdit&&i){var p=N(lf("Edit"),"edit icon"),u=i.package,f=i.compileBlocks,m=i.compilePython,g=u.host();n&&f?(u.setPreferredEditor(O.BLOCKS_PROJECT_NAME),g.writeFile(u,A,f.outfiles[A])):t&&m?(u.setPreferredEditor(O.PYTHON_PROJECT_NAME),g.writeFile(u,T,f.outfiles[T])):u.setPreferredEditor(O.JAVASCRIPT_PROJECT_NAME),r.jres&&(g.writeFile(u,O.TILEMAP_JRES,r.jres),g.writeFile(u,O.TILEMAP_CODE,O.emitTilemapsFromJRes(JSON.parse(r.jres))),u.config.files.push(O.TILEMAP_JRES),u.config.files.push(O.TILEMAP_CODE));var h=u.compressToFileAsync();p.click(function(){O.tickEvent("docs.btn",{button:"edit"}),h.done(function(e){window.open((r.pxtUrl||O.appTarget.appTheme.homeUrl||"").replace(/\/$/,"")+"/#project:"+ts.pxtc.encodeBase64(O.Util.uint8ArrayToString(e)),"pxt")})}),l.append(p)}if(r.showJavaScript||!n&&!t?(c.append(a),y(),x()):n?(c.append(n),w(),x()):t&&(c.append(t),y(),w()),o.run&&!d.hideDocsSimulator){var v=N(lf("Run"),"play icon").click(function(){if(O.tickEvent("docs.btn",{button:"sim"}),c.find(".sim")[0])c.find(".sim").remove(),C(c);else{var e="81.97%";O.appTarget.simulator&&(e=100/O.appTarget.simulator.aspectRatio+"%");var t=r.package?"&deps="+encodeURIComponent(r.package):"",n=I(r)+"#nofooter=1"+t,i=encodeURIComponent(a.text()),o=$('<div class="ui card sim"><div class="ui content"><div style="position:relative;height:0;padding-bottom:'+e+';overflow:hidden;"><iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" src="'+n+'" data-code="'+i+'" allowfullscreen="allowfullscreen" sandbox="allow-popups allow-forms allow-scripts allow-same-origin" frameborder="0"></iframe></div></div></div>');c.append(o),C(o)}});l.append(v)}if(o.hexname&&o.hex){var k=N(lf("Download"),"download icon").click(function(){O.tickEvent("docs.btn",{button:"hex"}),O.BrowserUtils.browserDownloadBinText(o.hex,o.hexname,O.appTarget.compile.hexMimeType)});l.append(k)}var b=$("<div class=codesnippet></div>");function y(){if(n){var e=N(lf("Blocks"),E).click(function(){O.tickEvent("docs.btn",{button:"blocks"}),c.find(".blocks")[0]?(c.find(".blocks").remove(),C(c)):(R(a?a.parent():c,n),C(n))});l.append(e)}}function w(){if(a)if(o.showJs)j(c,a);else{var e=N("JavaScript",P).click(function(){O.tickEvent("docs.btn",{button:"js"}),c.find(".js")[0]?(c.find(".js").remove(),C(c)):(j(n?n.parent():c,a),C(a))});l.append(e)}}function x(){if(t)if(o.showPy)B(c,t);else{var e=N("Python",S).click(function(){O.tickEvent("docs.btn",{button:"py"}),c.find(".py")[0]?(c.find(".py").remove(),C(c)):(B(n?n.parent():c,t),C(t))});l.append(e)}}function C(e){var t;null===(t=e[0])||void 0===t||t.scrollIntoView({behavior:"smooth",block:"center"})}l.children().length&&b.append(s),b.append(c),e.replaceWith(b)}e.defaultClientRenderOptions=r;var t,l=[];function p(e,t,n){if(!e)return Promise.resolve();var i=$("."+e).first();return i[0]?(n.emPixels||(n.emPixels=18),n.layout||(n.layout=O.blocks.BlockLayout.Align),n.splitSvg=!0,l.push({el:i,source:i.text(),options:n,render:t}),i.addClass("lang-shadow"),i.removeClass(e),p(e,t,n)):Promise.resolve()}function y(e){if(!e||e.kind!=ts.SyntaxKind.ExpressionStatement)return null;var t=e;if(!t.expression||t.expression.kind!=ts.SyntaxKind.CallExpression)return null;var n=t.expression;return pxtc.pxtInfo(n).callInfo}function d(e){return t||(t=O.runner.decompileSnippetAsync("",e)),t}function m(e,t){if(t){var n=/^\/(v\d+)/.exec(t.url),i=/^\/(v\d+)/.exec(window.location.pathname),o=/#doc/i.test(window.location.href);t.url&&!n&&i&&!o&&(t.url="/"+i[1]+"/"+t.url),e.append(O.docs.codeCard.render(t,{hideHeader:!0,shortName:!0}))}}function g(e,t,n){var i,o=t.attributes,r=!o.blockHidden&&Blockly.Blocks[o.blockId];if(null===(i=r)||void 0===i?void 0:i.codeCard){var a=O.U.clone(r.codeCard);n&&(a.style=n),m(e,a)}else m(e,{name:t.qName,description:o.jsDoc,url:o.help||void 0,style:n})}function u(e,t,i,f){return p(t,function(e,p){var t=p.compileProgram;if(t){var n=t.getSourceFile("main.ts").statements.slice(0),u=$("<div />").addClass("ui cards");u.attr("role","listbox"),n.forEach(function(e){var t=e.kind,n=y(e);if(n&&p.apiInfo&&p.apiInfo.byQName[n.qName]){var i=p.apiInfo.byQName[n.qName],o=i.attributes,r=Blockly.Blocks[o.blockId];if(f){var a=i,s=p.compileBlocks.blocksInfo.apis.byQName[a.namespace];m(u,{name:s.attributes.blockNamespace||s.name,url:s.attributes.help||"reference/"+(s.attributes.blockNamespace||s.name).toLowerCase(),description:s.attributes.jsDoc,blocksXml:r&&r.codeCard?r.codeCard.blocksXml:o.blockId?'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="'+o.blockId+'"></block></xml>':void 0})}else g(u,i)}else switch(t){case ts.SyntaxKind.ExpressionStatement:var c=e;switch(c.expression.kind){case ts.SyntaxKind.TrueKeyword:case ts.SyntaxKind.FalseKeyword:m(u,{name:"Boolean",url:"blocks/logic/boolean",description:lf("True or false values"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="logic_boolean"><field name="BOOL">TRUE</field></block></xml>'});break;default:O.debug("card expr kind: "+c.expression.kind)}break;case ts.SyntaxKind.IfStatement:m(u,{name:f?"Logic":"if",url:"blocks/logic"+(f?"":"/if"),description:f?lf("Logic operators and constants"):lf("Conditional statement"),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_if"></block></xml>'});break;case ts.SyntaxKind.WhileStatement:m(u,{name:f?"Loops":"while",url:"blocks/loops"+(f?"":"/while"),description:f?lf("Loops and repetition"):lf("Repeat code while a condition is true."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="device_while"></block></xml>'});break;case ts.SyntaxKind.ForOfStatement:m(u,{name:f?"Loops":"for of",url:"blocks/loops"+(f?"":"/for-of"),description:f?lf("Loops and repetition"):lf("Repeat code for each item in a list."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_for_of"></block></xml>'});break;case ts.SyntaxKind.BreakStatement:m(u,{name:f?"Loops":"break",url:"blocks/loops"+(f?"":"/break"),description:f?lf("Loops and repetition"):lf("Break out of the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="break_keyword"></block></xml>'});break;case ts.SyntaxKind.ContinueStatement:m(u,{name:f?"Loops":"continue",url:"blocks/loops"+(f?"":"/continue"),description:f?lf("Loops and repetition"):lf("Skip iteration and continue the current loop."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="continue_keyboard"></block></xml>'});break;case ts.SyntaxKind.ForStatement:var l=e,d=!0;3==l.condition.getChildCount()&&(d=!("0"==l.condition.getChildAt(0).getText()||l.condition.getChildAt(1).kind==ts.SyntaxKind.LessThanToken)),m(u,d?{name:f?"Loops":"for",url:"blocks/loops"+(f?"":"/for"),description:f?lf("Loops and repetition"):lf("Repeat code for a given number of times using an index."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_simple_for"></block></xml>'}:{name:f?"Loops":"repeat",url:"blocks/loops"+(f?"":"/repeat"),description:f?lf("Loops and repetition"):lf("Repeat code for a given number of times."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="controls_repeat_ext"></block></xml>'});break;case ts.SyntaxKind.VariableStatement:m(u,{name:f?"Variables":"variable declaration",url:"blocks/variables"+(f?"":"/assign"),description:f?lf("Variables"):lf("Assign a value to a named variable."),blocksXml:'<xml xmlns="http://www.w3.org/1999/xhtml"><block type="variables_set"></block></xml>'});break;default:O.debug("card kind: "+t)}}),i&&(e=e.parent()),e.replaceWith(u)}},{package:e.package,aspectRatio:e.blocksAspectRatio,jres:e.jres})}function f(e,t){if(!e)return Promise.resolve();var n,i=$("."+e).first();if(!i[0])return Promise.resolve();i.removeClass(e);try{var o=JSON.parse(i.text());Array.isArray(o)||(o=[o]),n=o}catch(e){O.reportException(e),i.append($("<div/>").addClass("ui segment warning").text(e.messageText))}return t.snippetReplaceParent&&(i=i.parent()),function(e,t,a){if(!t||0==t.length)return Promise.resolve();if(0==t.length){var n=O.docs.codeCard.render(t[0],a);e.replaceWith(n)}else{var s=document.createElement("div");s.className="ui cards",s.setAttribute("role","listbox"),t.forEach(function(t){var e=/^\/(v\d+)/.exec(t.url),n=/^\/(v\d+)/.exec(window.location.pathname),i=/#doc/i.test(window.location.href);t.url&&!e&&n&&!i&&(t.url="/"+n[1]+t.url);var o=O.docs.codeCard.render(t,a);if(s.appendChild(o),"package"==t.cardType){var r=O.github.parseRepoId((t.url||"").replace(/^\/pkg\//,""));r&&O.packagesConfigAsync().then(function(e){switch(O.github.repoStatus(r,e)){case O.github.GitRepoStatus.Banned:o.remove();break;case O.github.GitRepoStatus.Approved:t.imageUrl=O.github.mkRepoIconUrl(r),s.insertBefore(O.docs.codeCard.render(t,a),o),o.remove()}}).catch(function(e){O.reportException(e),O.debug("failed to load repo "+t.url)})}}),e.replaceWith(s)}return Promise.resolve()}(i,n,{hideHeader:!0}).then(function(){return Promise.delay(1,f(e,t))})}function I(e){return e.pxtUrl?e.pxtUrl+"/--run":O.webConfig&&O.webConfig.runUrl?O.webConfig.runUrl:"/--run"}function h(i){var o={showEdit:!!i.showEdit,run:!!i.simulator};$("code.lang-python").each(function(e,t){!function(e,t){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),a($(e)));var n=O.U.clone(o);t&&(n.run=!1,n.showEdit=!1),b(i,$(e).parent(),$(e),void 0,void 0,void 0,n)}(t,!1),$(t).removeClass("lang-python")})}e.renderAsync=function(t){var o,i,e,n,c;return O.analytics.enable(),t||(t=r()),t.pxtUrl&&(t.pxtUrl=t.pxtUrl.replace(/\/$/,"")),t.showEdit&&(t.showEdit=!O.BrowserUtils.isIFrame()),(o=t).packageClass&&($("."+o.packageClass).each(function(e,t){var n=$(t),i=n.text().split("\n").map(function(e){return e.replace(/\s*/g,"")}).filter(function(e){return!!e}).join(",");o.package=o.package?o.package+","+i:i,o.snippetReplaceParent&&(n=n.parent()),n.remove()}),$(".lang-config").each(function(e,t){var n=$(t);o.snippetReplaceParent&&(n=n.parent()),n.remove()})),(i=t).jresClass&&$("."+i.jresClass).each(function(e,t){var n=$(t);i.jres=n.text(),n.remove()}),l=[],e=t,n=$("code.lang-ghost"),e.snippetReplaceParent&&(n=n.parent()),n.remove(),(c=t).simulatorClass&&$("."+c.simulatorClass).each(function(e,t){var n=$(t),i="81.97%";O.appTarget.simulator&&(i=100/O.appTarget.simulator.aspectRatio+"%");var o=$('<div class="ui card"><div class="ui content">\n                    <div style="position:relative;height:0;padding-bottom:'+i+';overflow:hidden;">\n                    <iframe style="position:absolute;top:0;left:0;width:100%;height:100%;" allowfullscreen="allowfullscreen" frameborder="0" sandbox="allow-popups allow-forms allow-scripts allow-same-origin"></iframe>\n                    </div>\n                    </div></div>'),r=c.package?"&deps="+encodeURIComponent(c.package):"",a=I(c)+"#nofooter=1"+r,s=encodeURIComponent(n.text().trim());o.find("iframe").attr("src",a),o.find("iframe").attr("data-code",s),c.snippetReplaceParent&&(n=n.parent()),n.replaceWith(o)}),function(i){var o={showEdit:!!i.showEdit,run:!!i.simulator};function n(e,t){"undefined"!=typeof hljs&&($(e).text($(e).text().replace(/^\s*\r?\n/,"")),hljs.highlightBlock(e),a($(e)));var n=O.U.clone(o);t&&(n.run=!1,n.showEdit=!1),b(i,$(e).parent(),$(e),void 0,void 0,void 0,n)}$("code.lang-typescript").each(function(e,t){n(t,!1),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-ignore").each(function(e,t){$(t).removeClass("lang-typescript-ignore"),$(t).addClass("lang-typescript"),n(t,!0),$(t).removeClass("lang-typescript")}),$("code.lang-typescript-invalid").each(function(e,t){$(t).removeClass("lang-typescript-invalid"),$(t).addClass("lang-typescript"),n(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("invalid"),$(t).parent("div").prepend($("<i>",{class:"icon ban"})),$(t).addClass("invalid")}),$("code.lang-typescript-valid").each(function(e,t){$(t).removeClass("lang-typescript-valid"),$(t).addClass("lang-typescript"),n(t,!0),$(t).removeClass("lang-typescript"),$(t).parent("div").addClass("valid"),$(t).parent("div").prepend($("<i>",{class:"icon check"})),$(t).addClass("valid")})}(t),h(t),Promise.resolve().then(function(){return f(t.codeCardClass,t)}).then(function(){return e=t,"core"==O.appTarget.id?Promise.resolve():d(e).then(function(e){var i={},o=e.compileBlocks.blocksInfo;o.blocks.forEach(function(e){var t=(e.attributes.blockNamespace||e.namespace).split(".")[0];if(!i[t]){var n=o.apis.byQName[t];n&&n.attributes.color&&(i[t]=n.attributes.color)}});var n="";return Object.keys(i).forEach(function(e){var t=i[e]||"#dddddd";n+="\n                        span.docs."+e.toLowerCase()+" {\n                            background-color: "+t+" !important;\n                            border-color: "+O.toolbox.fadeColor(t,.1,!1)+" !important;\n                        }\n                    "}),n}).then(function(n){return Object.keys(O.toolbox.blockColors).forEach(function(e){var t=O.toolbox.getNamespaceColor(e);n+="\n                        span.docs."+e.toLowerCase()+" {\n                            background-color: "+t+" !important;\n                            border-color: "+O.toolbox.fadeColor(t,.1,!1)+" !important;\n                        }\n                    "}),n}).then(function(e){var t=document.createElement("style");t.id="namespaceColors",t.type="text/css",(document.head||document.getElementsByTagName("head")[0]).appendChild(t),t.appendChild(document.createTextNode(e))});var e}).then(function(){return function(d){(d=O.Util.clone(d)).emPixels=18,d.snippetMode=!0;var p=$(":not(pre) > code"),u=0;return function o(){if(u>=p.length)return Promise.resolve();var r=$(p[u++]),e=r.text(),t=/^(\|+)([^\|]+)\|+$/.exec(e);if(t){var n=/^(([^\:\.]*?)[\:\.])?(.*)$/.exec(t[2]),i=n[2]?n[2].trim().toLowerCase():"",a=1==t[1].length?"docs inlinebutton "+i:"docs inlineblock "+i,s=n[3].trim();return r.replaceWith($('<span class="'+a+'"/>').text(O.U.rlf(s))),o()}var c=/^\[([^\]]+)\]$/.exec(e);if(!c)return o();var l=c[1];return O.runner.decompileSnippetAsync(l,d).then(function(e){if(e.blocksSvg){var t=$('<span class="block"/>').append(e.blocksSvg),n=y(e.compileProgram.getSourceFile("main.ts").statements[0]);if(n&&e.apiInfo){var i=e.apiInfo.byQName[n.qName];i&&i.attributes.help&&(t=$('<a class="ui link"/>').attr("href","/reference/"+i.attributes.help).append(t))}r.replaceWith(t)}return Promise.delay(1,o())})}()}(t)}).then(function(){return u(t,t.linksClass,t.snippetReplaceParent,!1)}).then(function(){return u(t,t.namespacesClass,t.snippetReplaceParent,!0)}).then(function(){return function(e,s){var t=e.apisClass;if(!t)return Promise.resolve();var n=$("."+t);return n.length?d(e).then(function(e){var t=e.compileBlocks.blocksInfo,a=O.Util.values(t.apis.byQName).filter(function(e){return!(e.attributes.hidden||e.attributes.deprecated||e.attributes.blockAliasFor||!e.attributes.jsDoc||!e.attributes.block||/^__/.test(e.name))});n.each(function(e,t){var n=$(t),i=O.Util.toDictionary(n.text().split("\n"),function(e){return e}),o=a.filter(function(e){return!!i[e.attributes.blockNamespace||e.namespace]});if(o.length){o.sort(function(e,t){var n=!e.attributes.blockHidden&&Blockly.Blocks[e.attributes.blockId],i=!t.attributes.blockHidden&&Blockly.Blocks[t.attributes.blockId];return!!n!=!!i?(i?1:0)-(n?1:0):e.name.localeCompare(t.name)});var r=$("<div />").addClass("ui divided items");r.attr("role","listbox"),o.forEach(function(e){return g(r,e,"item")}),s&&(n=n.parent()),n.replaceWith(r)}})}):Promise.resolve()}(t,t.snippetReplaceParent)}).then(function(){return p((k=t).signatureClass,function(e,t){var n,i,o,r,a,s=t.compileProgram;if(s){var c=y(s.getSourceFile("main.ts").statements[0]);if(c&&t.apiInfo){var l=t.apiInfo.byQName[c.qName];if(l){var d=(null===(i=null===(n=Blockly.Blocks[l.attributes.blockId])||void 0===n?void 0:n.codeCard)||void 0===i?void 0:i.blocksXml)||void 0,p=d?O.blocks.render(d):(null===(o=t.compileBlocks)||void 0===o?void 0:o.success)?t.blocksSvg:void 0,u=p?$(p):void 0,f=ts.pxtc.service.displayStringForSymbol(l,!1,t.apiInfo).split("\n")[1]+";",m=$('<code class="lang-typescript highlight"/>').text(f),g=(null===(a=null===(r=O.appTarget)||void 0===r?void 0:r.appTheme)||void 0===a?void 0:a.python)&&ts.pxtc.service.displayStringForSymbol(l,!0,t.apiInfo).split("\n")[1],h=g&&$('<code class="lang-python highlight"/>').text(g);if(k.snippetReplaceParent&&(e=e.parent()),O.Util.isTranslationMode()){var v=$('<div class="ui segment" />');v.append($('<div class="ui header"><i class="ui xicon globe"></i></div>')),l.attributes.translationId&&v.append($('<div class="ui message">').text(l.attributes.translationId)),l.attributes.jsDoc&&v.append($('<div class="ui message">').text(l.attributes.jsDoc)),v.insertAfter(e)}b(k,e,m,h,u,t,{showJs:!0,showPy:!0,hideGutter:!0})}}}},{package:k.package,snippetMode:!0,aspectRatio:k.blocksAspectRatio,jres:k.jres});var k}).then(function(){return function(l){if(l.tutorial)return p(l.snippetClass,function(e,t){var n=t.blocksSvg;l.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(n);e.replaceWith(i)},{package:l.package,snippetMode:!1,aspectRatio:l.blocksAspectRatio,jres:l.jres});var d=0;return p(l.snippetClass,function(e,t){var n=t.compileBlocks&&t.compileBlocks.success?$(t.blocksSvg):void 0,i=t.compilePython&&t.compilePython.success&&t.compilePython.outfiles["main.py"],o=$('<code class="lang-typescript highlight"/>').text(e.text().trim()),r=i?$('<code class="lang-python highlight"/>').text(i.trim()):void 0;l.snippetReplaceParent&&(e=e.parent());var a=t.compileJS&&t.compileJS.success,s=l.hex&&a&&t.compileJS.outfiles[pxtc.BINARY_HEX]?t.compileJS.outfiles[pxtc.BINARY_HEX]:void 0,c=(O.appTarget.nickname||O.appTarget.id)+"-"+(l.hexName||"")+"-"+d+++".hex";b(l,e,o,r,n,t,{showEdit:l.showEdit,run:l.simulator,hexname:c,hex:s})},{package:l.package,aspectRatio:l.blocksAspectRatio,jres:l.jres})}(t)}).then(function(){return p((o=t).blocksClass,function(e,t){var n=t.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(n);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres});var o}).then(function(){return(o=t).blocksXmlClass?function t(n,i,o){var r=$("."+n).first();return r[0]?(o.emPixels||(o.emPixels=18),o.splitSvg=!0,O.runner.compileBlocksAsync(r.text(),o).then(function(e){try{i(r,e)}catch(e){O.reportException(e),r.append($("<div/>").addClass("ui segment warning").text(e.message))}return r.removeClass(n),Promise.delay(1,t(n,i,o))})):Promise.resolve()}(o.blocksXmlClass,function(e,t){var n=t.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(n);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres}):Promise.resolve();var o}).then(function(){return(o=t).diffBlocksXmlClass?function n(i,o,r){var a=$("."+i).first();if(!a[0])return Promise.resolve();r.emPixels||(r.emPixels=18),r.splitSvg=!0;var e=a.text().split(/-{10,}/),s=e[0],c=e[1];return O.runner.compileBlocksAsync("",r).then(function(e){a.removeClass(i);try{var t=O.blocks.diffXml(s,c);t?(e.blocksSvg=t.svg,o(a,e)):a.text("no changes")}catch(e){O.reportException(e),a.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,n(i,o,r))})}(o.diffBlocksXmlClass,function(e,t){var n=t.blocksSvg;o.snippetReplaceParent&&(e=e.parent());var i=$('<div class="ui segment codewidget"/>').append(n);e.replaceWith(i)},{package:o.package,snippetMode:!0,aspectRatio:o.blocksAspectRatio,jres:o.jres}):Promise.resolve();var o}).then(function(){return(u=t).diffBlocksClass?function s(c){var l=$("."+c).first();if(!l[0])return Promise.resolve();var e=O.diff.split(l.text(),{removeTrailingSemiColumns:!0}),d=e.fileA,p=e.fileB;return Promise.mapSeries([d,p],function(e){return O.runner.decompileSnippetAsync(e,{generateSourceMap:!0})}).then(function(e){try{var t=O.blocks.decompiledDiffAsync(d,e[0].compileBlocks,p,e[1].compileBlocks,{hideDeletedTopBlocks:!0,hideDeletedBlocks:!0}),n=O.diff.render(d,p,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0}),i=void 0,o=e.map(function(e){return e.compilePython&&e.compilePython.outfiles&&e.compilePython.outfiles["main.py"]}),r=o[0],a=o[1];r&&a&&(i=O.diff.render(r,a,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0})),b(u,l.parent(),$(n),i&&$(i),$(t.svg),void 0,{showEdit:!1,run:!1,hexname:void 0,hex:void 0})}catch(e){O.reportException(e),l.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,s(c))})}(u.diffBlocksClass):Promise.resolve();var u}).then(function(){return(c=t).diffClass?function e(t){var n=$("."+t).first();if(!n[0])return Promise.resolve();var i=O.diff.split(n.text()),o=i.fileA,r=i.fileB;try{var a=O.diff.render(o,r,{hideLineNumbers:!0,hideMarkerLine:!0,hideMarker:!0,hideRemoved:!0,update:!0,ignoreWhitespace:!0});c.snippetReplaceParent&&(n=n.parent());var s=$('<div class="ui segment codewidget"/>').append(a);n.removeClass(t),n.replaceWith(s)}catch(e){O.reportException(e),n.append($("<div/>").addClass("ui segment warning").text(e.message))}return Promise.delay(1,e(t))}(c.diffClass):Promise.resolve();var c}).then(function(){return a={showEdit:!!(r=t).showEdit,run:!!r.simulator},p(r.staticPythonClass,function(e,t){var n=t.compilePython;if(n&&n.success){var i=e.clone().removeClass("lang-shadow").addClass("highlight"),o=i.clone().addClass("lang-python").text(n.outfiles["main.py"]);i.addClass("lang-typescript"),s(o),b(r,e.parent(),i,o,void 0,t,a)}},{package:r.package,snippetMode:!0,jres:r.jres});var r,a}).then(function(){return(r=t).projectClass?function e(){var t=$("."+r.projectClass).first(),n=t[0];if(!n)return Promise.resolve();t.removeClass(r.projectClass);var i=O.Cloud.parseScriptId(n.innerText);if(i){if(r.snippetReplaceParent){n=n.parentElement;var o=document.createElement("div");n.parentElement.insertBefore(o,n),n.parentElement.removeChild(n),n=o}return O.runner.renderProjectAsync(n,i).then(function(){return e()})}return e()}():Promise.resolve();var r}).then(function(){return r={},function e(){var t=l.shift();if(!t)return Promise.resolve();var n=t.el,i=t.options,o=t.render;return O.runner.decompileSnippetAsync(n.text(),i).then(function(e){var t=e.compileJS&&e.compileJS.diagnostics&&e.compileJS.diagnostics.filter(function(e){return e.category==pxtc.DiagnosticCategory.Error});t&&t.length&&t.forEach(function(e){return O.reportError("docs.decompile",""+e.messageText,{code:e.code+""})}),e.blocksSvg.querySelectorAll("defs *").forEach(function(e){r[e.id]?e.remove():r[e.id]=!0}),o(n,e)},function(e){O.reportException(e),n.append($("<div/>").addClass("ui segment warning").text(e.message))}).finally(function(){return n.removeClass("lang-shadow"),e()})}().then(function(){Blockly.Workspace.getAll().forEach(function(e){return e.dispose()}),O.blocks.cleanRenderingWorkspace()});var r})}}(O.runner||(O.runner={}))}(pxt||(pxt={})),function(T){!function(l){var c,o=function(){function e(e,t){this.ksPkg=e,this.topPkg=t,this.files={}}return e.prototype.getKsPkg=function(){return this.ksPkg},e.prototype.getPkgId=function(){return this.ksPkg?this.ksPkg.id:this.id},e.prototype.isTopLevel=function(){return this.ksPkg&&0==this.ksPkg.level},e.prototype.setFiles=function(e){this.files=e},e.prototype.getAllFiles=function(){return T.Util.mapMap(this.files,function(e,t){return t})},e}(),d=function(){function e(){this.githubPackageCache={}}return e.prototype.readFile=function(e,t){var n=u(e);return T.U.lookup(n.files,t)},e.prototype.writeFile=function(e,t,n){u(e).files[t]=n},e.prototype.getHexInfoAsync=function(e){return T.hexloader.getHexInfoAsync(this,e)},e.prototype.cacheStoreAsync=function(e,t){return Promise.resolve()},e.prototype.cacheGetAsync=function(e){return Promise.resolve(null)},e.prototype.patchDependencies=function(e,t,n){if(!n)return!1;var i=T.github.parseRepoId(n);if(!i)return!1;for(var o=0,r=Object.keys(e.dependencies);o<r.length;o++){var a=r[o],s=e.dependencies[a],c=T.github.parseRepoId(s);if(c&&i.fullName==c.fullName)return T.semver.strcmp(i.tag,c.tag)<0&&(e.dependencies[a]=n),!0}return!1},e.prototype.downloadPackageAsync=function(o,r){var a=this,s=o.verProtocol(),c=void 0;"github"==s&&(c=this.githubPackageCache[o._verspec]);var l=u(o);return(c?Promise.resolve(c):o.commonDownloadAsync()).then(function(e){if(e)return"github"!=s||c||(a.githubPackageCache[o._verspec]=T.Util.clone(e)),l.setFiles(e),Promise.resolve();if("empty"==s){if(0==Object.keys(l.files).length&&l.setFiles(f()),r&&r.length){var t=u(o).files,n=JSON.parse(t[T.CONFIG_NAME]);r.forEach(function(e){p(n,e)}),t[T.CONFIG_NAME]=T.Package.stringifyConfig(n)}return Promise.resolve()}if("docs"==s){t=f();var i=JSON.parse(t[T.CONFIG_NAME]);return o.verArgument().split(",").forEach(function(e){p(i,e)}),i.yotta||(i.yotta={}),i.yotta.ignoreConflicts=!0,t[T.CONFIG_NAME]=T.Package.stringifyConfig(i),l.setFiles(t),Promise.resolve()}return"invalid"==s?(T.log("skipping invalid pkg "+o.id),Promise.resolve()):Promise.reject("Cannot download "+o.version()+"; unknown protocol")})},e}();function p(e,t){var n=/^([a-zA-Z0-9_-]+)(=(.+))?$/.exec(t);if(n){if(n[3]&&this&&this.patchDependencies(e,n[1],n[3]))return!1;e.dependencies[n[1]]=n[3]||"*"}else console.warn("unknown package syntax "+t);return!0}function u(e){var t=e._editorPkg;if(t)return t;var n=null;e!=l.mainPkg&&(n=u(l.mainPkg));var i=new o(e,n);return e==l.mainPkg&&(i.topPkg=i),e._editorPkg=i}function f(){var e=T.appTarget.tsprj,t=T.U.clone(e.files);return t[T.CONFIG_NAME]=T.Package.stringifyConfig(e.config),t["main.blocks"]="",t}function e(){T.setAppTarget(window.pxtTargetBundle),T.Util.assert(!!T.appTarget);var e=window.location.href,t=!1,n=!1,i=void 0;if(/[&?]translate=1/.test(e)&&!T.BrowserUtils.isIE())i=ts.pxtc.Util.TRANSLATION_LOCALE,n=t=!0;else{var o=/PXT_LANG=(.*?)(?:;|$)/.exec(document.cookie),r=/(live)?(force)?lang=([a-z]{2,}(-[A-Z]+)?)/i.exec(e);i=r?r[3]:o&&o[1]||T.appTarget.appTheme.defaultLocale||navigator.userLanguage||navigator.language,t=!T.appTarget.appTheme.disableLiveTranslations||r&&!!r[1],n=!!r&&!!r[2]}var a=T.appTarget.versions;$&&$.fn&&$.fn.embed&&$.fn.embed.settings&&$.fn.embed.settings.sources&&$.fn.embed.settings.sources.youtube&&($.fn.embed.settings.sources.youtube.url="//www.youtube.com/embed/{id}?rel=0");var s=T.webConfig;return T.Util.updateLocalizationAsync(T.appTarget.id,s.commitCdnUrl,i,a?a.pxtCrowdinBranch:"",a?a.targetCrowdinBranch:"",t,n).then(function(){l.mainPkg=new T.MainPackage(new d)})}function s(e){console.error(e)}T.react.getTilemapProject||(T.react.getTilemapProject=function(){return c||(c=new T.TilemapProject).loadPackage(l.mainPkg),c}),l.initFooter=function(e,t){if(e){var n=T.appTarget.appTheme,i=$("body"),o=$(e),r=$("<a/>").attr("href",n.homeUrl).attr("target","_blank");o.append(r),n.organizationLogo?r.append($("<img/>").attr("src",T.Util.toDataUri(n.organizationLogo))):r.append(lf("powered by {0}",n.title)),i.mouseenter(function(e){return o.fadeOut()}),i.mouseleave(function(e){return o.fadeIn()})}},l.showError=s;var m,t,g=void 0;function r(e,n,t){var i,o,r,a=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj";return g&&g._verspec==a?(l.mainPkg=g,i=l.mainPkg.host(),o=Promise.resolve(),r=Promise.resolve()):(i=l.mainPkg.host(),l.mainPkg=new T.MainPackage(i),l.mainPkg._verspec=e?/\w+:\w+/.test(e)?e:"pub:"+e:"empty:tsprj",o=i.downloadPackageAsync(l.mainPkg,t),r=l.mainPkg.installAllAsync(),g=l.mainPkg),o.then(function(){return i.readFile(l.mainPkg,T.CONFIG_NAME)}).then(function(e){return e?r.then(function(){if(n){var e=u(l.mainPkg);e.files["main.ts"]=n;var t=JSON.parse(e.files[T.CONFIG_NAME]);t.name=window.location.href.split("/").pop().split(/[?#]/)[0],e.files[T.CONFIG_NAME]=T.Package.stringifyConfig(t),l.mainPkg.config.name=t.name,-1==l.mainPkg.config.files.indexOf("main.blocks")&&l.mainPkg.config.files.push("main.blocks")}}).catch(function(e){s(lf("Cannot load extension: {0}",e.message))}):Promise.resolve()})}function a(e){var t=l.mainPkg.getTargetOptions();return t.isNative=!!e,t.hasHex=!!e,l.mainPkg.getCompileOptionsAsync(t)}function n(e,n){return a(e).then(function(e){n&&n(e);var t=pxtc.compile(e);return t.diagnostics&&0<t.diagnostics.length&&t.diagnostics.forEach(function(e){console.error(e.messageText)}),t})}function h(e){var t={};try{var n=window.localStorage.getItem(e);n&&(t=JSON.parse(n))}catch(e){}return t}function v(e,t){if(l.editorLanguageMode=e,t!=T.Util.localeInfo()){var n=/^live-/;return T.Util.updateLocalizationAsync(T.appTarget.id,T.webConfig.commitCdnUrl,t.replace(n,""),T.appTarget.versions.pxtCrowdinBranch,T.appTarget.versions.targetCrowdinBranch,n.test(t))}return Promise.resolve()}function k(e){var t=e.data;if(t)switch(t.type){case"fileloaded":var n=t,i=n.name;v(/\.ts$/i.test(i)?m.TypeScript:m.Blocks,n.locale).done();break;case"popout":var o=/((\/v[0-9+])\/)?[^\/]*#(doc|md):([^&?:]+)/i.exec(window.location.href);if(o){var r=T.webConfig.docsUrl||"/--docs",a=o[2]||"",s="doc"==o[3]?T.webConfig.isStatic?"/docs"+o[4]+".html":""+o[4]:r+"?md="+o[4];window.parent&&window.parent.postMessage({type:"opendoc",url:T.BrowserUtils.urlJoin(a,s)},"*")}break;case"localtoken":var c=t;c&&c.localToken&&(T.Cloud.localToken=c.localToken,E.forEach(function(e){return e()}),E=[])}}function b(t,n){return T.Cloud.privateGetTextAsync(n+"/text").then(function(e){return JSON.parse(e)}).then(function(e){return y(t,e,n)})}function y(e,t,n,i){void 0===n&&(n=null),void 0===i&&(i=!1);var o=JSON.parse(t[T.CONFIG_NAME])||{},r="# "+o.name+" "+(o.version?o.version:"")+"\n\n",a="README.md";t[a]&&(r+=t[a].replace(/^#+/,"$0#")+"\n"),o.files.filter(function(e){return e!=T.CONFIG_NAME&&e!=a}).filter(function(e){return l.editorLanguageMode==m.Blocks==/\.blocks?$/.test(e)}).forEach(function(e){/^main\.(ts|blocks)$/.test(e)||(r+="\n## "+e+"\n"),/\.ts$/.test(e)?r+="```typescript\n"+t[e]+"\n```\n":/\.blocks?$/.test(e)?r+="```blocksxml\n"+t[e]+"\n```\n":r+="```"+e.substr(e.indexOf("."))+"\n"+t[e]+"\n```\n"});var s=o&&o.dependencies&&Object.keys(o.dependencies).filter(function(e){return e!=T.appTarget.corepkg});if(s&&s.length&&(r+="\n## "+lf("Extensions")+" #extensions\n\n"+s.map(function(e){return"* "+e+", "+o.dependencies[e]}).join("\n")+"\n\n```package\n"+s.map(function(e){return e+"="+o.dependencies[e]}).join("\n")+"\n```\n"),n){var c=(T.appTarget.appTheme.shareUrl||"https://makecode.com/")+n;i&&(c="`"+c+"`"),r+="\n"+c+"\n\n"}console.debug("print md: "+r);return C(e,r,{print:!0})}l.generateHexFileAsync=function(t){return r(t.id).then(function(){return n(!0,function(e){t.code&&(e.fileSystem["main.ts"]=t.code)})}).then(function(e){return e.diagnostics&&0<e.diagnostics.length&&console.error("Diagnostics",e.diagnostics),e.outfiles[pxtc.BINARY_HEX]})},l.generateVMFileAsync=function(t){return T.setHwVariant("vm"),r(t.id).then(function(){return n(!0,function(e){t.code&&(e.fileSystem["main.ts"]=t.code)})}).then(function(e){return console.log(e),e})},l.simulateAsync=function(d,p){var s=!1;return r(p.id,p.code,p.dependencies).then(function(){return n(!1,function(e){if(p.code&&(e.fileSystem["main.ts"]=p.code),e.target.preferredEditor===T.PYTHON_PROJECT_NAME){e.target.preferredEditor=T.JAVASCRIPT_PROJECT_NAME,e.ast=!0;var t=P(pxtc.compile(e).ast,e);e.apisInfo=t,e.target.preferredEditor=T.PYTHON_PROJECT_NAME}var n=l.mainPkg.config.targetVersions.target,i=T.appTarget.versions.target;if(n&&i&&T.semver.cmp(T.semver.parse(n),T.semver.parse(i))<0)for(var o=0,r=Object.keys(e.fileSystem);o<r.length;o++){var a=r[o];!T.Util.startsWith(a,"pxt_modules")&&T.Util.endsWith(a,".ts")&&(s=!0,e.fileSystem[a]=T.patching.patchJavaScript(n,e.fileSystem[a]))}})}).then(function(e){var t;return 0<(null===(t=e.diagnostics)||void 0===t?void 0:t.length)&&s?(T.log("Compile with upgrade rules failed, trying again with original code"),n(!1,function(e){p.code&&(e.fileSystem["main.ts"]=p.code)})):e}).then(function(e){e.diagnostics&&0<e.diagnostics.length&&console.error("Diagnostics",e.diagnostics);var t=e.outfiles[pxtc.BINARY_JS];if(t){var n={};n.onSimulatorCommand=function(e){"restart"===e.command&&(l.storedState=h(p.id),i.run(t,l)),"setstate"==e.command&&e.stateKey&&e.stateValue&&function(e,t,n){var i=h(e);if(e){n?i[t]=n:delete i[t];try{window.localStorage.setItem(e,JSON.stringify(i))}catch(e){}}}(p.id,e.stateKey,e.stateValue)};var i=new pxsim.SimulatorDriver(d,n),o=e.usedArguments,r=T.appTarget.simulator.boardDefinition,a=pxtc.computeUsedParts(e,"ignorebuiltin"),s=pxtc.computeUsedParts(e,"onlybuiltin"),c=h(p.id),l={boardDefinition:r,parts:a,builtinParts:s,fnArgs:o,cdnUrl:T.webConfig.commitCdnUrl,localizedStrings:T.Util.getLocalizedStrings(),highContrast:p.highContrast,storedState:c,light:p.light};T.appTarget.simulator&&!p.fullScreen&&(l.aspectRatio=a.length&&T.appTarget.simulator.partsAspectRatio?T.appTarget.simulator.partsAspectRatio:T.appTarget.simulator.aspectRatio),i.run(t,l)}})},(t=m=l.LanguageMode||(l.LanguageMode={}))[t.Blocks=0]="Blocks",t[t.TypeScript=1]="TypeScript",l.editorLanguageMode=m.Blocks,l.setEditorContextAsync=v,l.startRenderServer=function(){T.tickEvent("renderer.ready");var o=[],r=void 0;T.editor.initEditorExtensionsAsync().done(function(){window.addEventListener("message",function(e){var t=e.data;"renderblocks"==t.type&&(o.push(t),function e(){if(!r){var t=o.shift();if(t){var n=t.options||{};n.splitSvg=!1,T.tickEvent("renderer.job");var i=/^\s*<xml/.test(t.code);r=T.BrowserUtils.loadBlocklyAsync().then(function(){return i?T.runner.compileBlocksAsync(t.code,n):l.decompileSnippetAsync(t.code,t.options)}).then(function(e){var t=e.blocksSvg;return t?T.blocks.layout.blocklyToSvgAsync(t,0,0,t.viewBox.baseVal.width,t.viewBox.baseVal.height):void 0}).then(function(e){window.parent.postMessage({source:"makecode",type:"renderblocks",id:t.id,width:e?e.width:void 0,height:e?e.height:void 0,svg:e?e.svg:void 0,uri:e?e.xml:void 0,css:e?e.css:void 0},"*")}).catch(function(e){window.parent.postMessage({source:"makecode",type:"renderblocks",id:t.id,error:e.message},"*")}).finally(function(){r=void 0,e()})}}}())},!1),window.parent.postMessage({source:"makecode",type:"renderready"},"*")})},l.startDocsServer=function(e,r,t){T.tickEvent("docrenderer.ready");var n=[];function a(i,o){T.debug("rendering "+i),t&&$(t).hide(),$(r).hide(),$(e).show(),Promise.delay(100).then(function(){switch(i){case"print":var e=window.localStorage.printjob;return delete window.localStorage.printjob,y(r,JSON.parse(e),void 0,!0).then(function(){return pxsim.print(1e3)});case"project":return y(r,JSON.parse(o)).then(function(){return pxsim.print(1e3)});case"projectid":return b(r,JSON.parse(o)).then(function(){return pxsim.print(1e3)});case"doc":return t=r,n=(n=o).replace(/^\//,""),T.Cloud.markdownAsync(n).then(function(e){return C(t,e,{path:n})});case"book":return function(n,e){var i,o=this;return e=e.replace(/^\//,""),T.tickEvent("book",{id:e}),T.log("rendering book from "+e),$("#loading").find(".loader").addClass("text").text(lf("Compiling your book (this may take a minute)")),Promise.delay(100).then(function(){return T.Cloud.markdownAsync(e)}).then(function(e){i=T.docs.buildTOC(e),T.log("TOC: "+JSON.stringify(i,null,2));var t=[];return T.docs.visitTOC(i,function(e){/^\//.test(e.path)&&!/^\/pkg\//.test(e.path)&&t.push(e)}),T.U.promisePoolAsync(4,t,function(n){return __awaiter(o,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,T.Cloud.markdownAsync(n.path)];case 1:return t=e.sent(),n.markdown=t,[3,3];case 2:return e.sent(),n.markdown="_"+n.path+" failed to load._",[3,3];case 3:return[2]}})})})}).then(function(e){var t=i[0].name;return T.docs.visitTOC(i,function(e){e.markdown&&(t+="\n\n"+e.markdown)}),C(n,t)})}(r,o);default:return C(r,o)}var t,n}).catch(function(e){$(r).html('\n                    <img style="height:4em;" src="'+T.appTarget.appTheme.docsLogo+'" />\n                    <h1>'+lf("Oops")+"</h1>\n                    <h3>"+lf("We could not load the documentation, please check your internet connection.")+'</h3>\n                    <button class="ui button primary" id="tryagain">'+lf("Try Again")+"</button>"),$(r).find("#tryagain").click(function(){a(i,o)}),window.parent&&window.parent.postMessage({type:"docfailed",docType:i,src:o},"*")}).finally(function(){$(e).hide(),t&&$(t).show(),$(r).show()}).done(function(){})}function i(e,t){t?(pxsim.U.addClass(e,"disabled"),e.setAttribute("aria-disabled","true")):(pxsim.U.removeClass(e,"disabled"),e.setAttribute("aria-disabled","false"))}function o(){var e=/^#(doc|md|tutorial|book|project|projectid|print):([^&?:]+)(:([^&?:]+):([^&?:]+))?/i.exec(window.location.hash);e&&(t&&(n.push(window.location.hash),10<n.length&&n.shift(),1<n.length&&i(t,!1)),(e[4]?v(/^blocks$/.test(e[4])?m.Blocks:m.TypeScript,e[5]):Promise.resolve()).then(function(){return a(e[1],decodeURIComponent(e[2]))}))}t&&(t.addEventListener("click",function(){t&&(1<n.length&&(n.pop(),window.location.hash=n.pop()),n.length<=1&&i(t,!0))}),i(t,!0)),T.editor.initEditorExtensionsAsync().done(function(){window.addEventListener("message",k,!1),window.addEventListener("hashchange",function(){o()},!1),parent.postMessage({type:"sidedocready"},"*"),setTimeout(function(){return o()},1)})},l.renderProjectAsync=b,l.renderProjectFilesAsync=y;var w,i,x='\n<aside id=button class=box>\n   <a class="ui primary button" href="@ARGS@">@BODY@</a>\n</aside>\n\n<aside id=vimeo>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="vimeo" data-id="@ARGS@" data-placeholder="/thumbnail/1024/vimeo/@ARGS@" data-icon="video play">\n    </div>\n</div></div>\n</aside>\n\n<aside id=youtube>\n<div class="ui two column stackable grid container">\n<div class="column">\n    <div class="ui embed mdvid" data-source="youtube" data-id="@ARGS@" data-placeholder="https://img.youtube.com/vi/@ARGS@/0.jpg">\n    </div>\n</div></div>\n</aside>\n\n<aside id=section>\n    \x3c!-- section @ARGS@ --\x3e\n</aside>\n\n<aside id=hide class=box>\n    <div style=\'display:none\'>\n        @BODY@\n    </div>\n</aside>\n\n<aside id=avatar class=box>\n    <div class=\'avatar @ARGS@\'>\n        <div class=\'avatar-image\'></div>\n        <div class=\'ui compact message\'>\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=hint class=box>\n    <div class="ui info message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=tutorialhint class=box>\n    <div class="ui hint message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=reminder class=box>\n    <div class="ui warning message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=alert class=box>\n    <div class="ui negative message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n<aside id=tip class=box>\n    <div class="ui positive message">\n        <div class="content">\n            @BODY@\n        </div>\n    </div>\n</aside>\n\n\x3c!-- wrapped around ordinary content --\x3e\n<aside id=main-container class=box>\n    <div class="ui text">\n        @BODY@\n    </div>\n</aside>\n\n\x3c!-- used for \'column\' box - they are collected and wrapped in \'column-container\' --\x3e\n<aside id=column class=aside>\n    <div class=\'column\'>\n        @BODY@\n    </div>\n</aside>\n<aside id=column-container class=box>\n    <div class="ui three column stackable grid text">\n        @BODY@\n    </div>\n</aside>\n@breadcrumb@\n@body@';function C(e,t,n){void 0===n&&(n={});var i=T.docs.renderMarkdown({template:x,markdown:t,theme:T.appTarget.appTheme}),o=n.blocksAspectRatio||window.innerHeight<window.innerWidth?1.62:1/1.62;$(e).html(i),$(e).find("a").attr("target","_blank");var r=T.runner.defaultClientRenderOptions();return r.tutorial=!!n.tutorial,r.blocksAspectRatio=o||r.blocksAspectRatio,r.showJavaScript=l.editorLanguageMode==m.TypeScript,n.print&&(r.showEdit=!1,r.simulator=!1),T.runner.renderAsync(r).then(function(){$(e).find('a[href^="/"]').removeAttr("target").each(function(e,t){$(t).attr("href","#doc:"+$(t).attr("href").replace(/^\//,""))}),$(e).find(".ui.embed").embed()})}function P(e,t){i||(i={});var n=Object.keys(t.fileSystem).sort().join(";");return i[n]||(i[n]=pxtc.getApiInfo(e,t.jres)),i[n]}l.renderMarkdownAsync=C,l.decompileSnippetAsync=function(n,s){return r(s&&s.packageId?"pub:"+s.packageId:s&&s.package?"docs:"+s.package:null,n).then(function(){return a(!!T.appTarget.compile&&T.appTarget.compile.hasHex)}).then(function(e){if(n&&(e.fileSystem["main.ts"]=n),e.ast=!0,s.jres){var t=T.emitTilemapsFromJRes(JSON.parse(s.jres));t&&(e.fileSystem[T.TILEMAP_JRES]=s.jres,e.fileSystem[T.TILEMAP_CODE]=t,e.sourceFiles.push(T.TILEMAP_JRES),e.sourceFiles.push(T.TILEMAP_CODE))}var i,o=void 0;s&&s.forceCompilation?(o=pxtc.compile(e),i=o&&o.ast):i=pxtc.getTSProgram(e,w),w=i;var r=void 0;T.appTarget.appTheme.python&&(r=ts.pxtc.transpile.tsToPy(i,"main.ts"));var a=P(i,e);return ts.pxtc.localizeApisAsync(a,l.mainPkg).then(function(){var e=pxtc.getBlocksInfo(a);T.blocks.initializeAndInject(e);var t=pxtc.decompiler.decompileToBlocks(e,i.getSourceFile("main.ts"),{snippetMode:s&&s.snippetMode,generateSourceMap:s&&s.generateSourceMap});if(t.diagnostics&&0<t.diagnostics.length&&t.diagnostics.forEach(function(e){return console.error(e.messageText)}),!t.success)return{package:l.mainPkg,compileProgram:i,compileJS:o,compileBlocks:t,apiInfo:a};T.debug(t.outfiles["main.blocks"]),s.jres&&((c=new T.TilemapProject).loadPackage(l.mainPkg),c.loadTilemapJRes(JSON.parse(s.jres),!0));var n=T.blocks.render(t.outfiles["main.blocks"],s);return s.jres&&(c=null),{package:l.mainPkg,compileProgram:i,compileJS:o,compileBlocks:t,compilePython:r,apiInfo:a,blocksSvg:n}})})},l.compileBlocksAsync=function(i,o){return r(o&&o.packageId?"pub:"+o.packageId:o&&o.package?"docs:"+o.package:null,"").then(function(){return a(!!T.appTarget.compile&&T.appTarget.compile.hasHex)}).then(function(e){if(e.ast=!0,o.jres){var t=T.emitTilemapsFromJRes(JSON.parse(o.jres));t&&(e.fileSystem[T.TILEMAP_JRES]=o.jres,e.fileSystem[T.TILEMAP_CODE]=t,e.sourceFiles.push(T.TILEMAP_JRES),e.sourceFiles.push(T.TILEMAP_CODE))}var n=P(pxtc.compile(e).ast,e);return ts.pxtc.localizeApisAsync(n,l.mainPkg).then(function(){var e=pxtc.getBlocksInfo(n);T.blocks.initializeAndInject(e),o.jres&&((c=new T.TilemapProject).loadPackage(l.mainPkg),c.loadTilemapJRes(JSON.parse(o.jres),!0));var t=T.blocks.render(i,o);return o.jres&&(c=null),{package:l.mainPkg,blocksSvg:t,apiInfo:n}})})};var S,E=[];l.initCallbacks=[],l.init=function(){e().done(function(){for(var e=0;e<l.initCallbacks.length;++e)l.initCallbacks[e]()})},(S=window.ksRunnerWhenLoaded)&&S()}(T.runner||(T.runner={}))}(pxt||(pxt={}));